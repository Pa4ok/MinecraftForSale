# Приватное ядро/движок сервера для 1.7.10 на основе Thermos

### Писать тут
- vk: https://vk.com/pa4ok
- tg: @pa4ok

### Информация
- цена 6000 рублей
- продается только в скомпилированном виде + папка src (система сборки и применения патчей не моя)
- ниже указаны только основные исправления, потому что перечислить все мелкие правки просто нереально
- из-за новой системы сохранения чанков не будет работать команда regenworld из плагина AutoSaveWorld
- не совместим с модами MobiusCore и Opis 

### Общее
- новая система учета зарегистрированных предметов (при добавлении/удалении модов)
- обновление библиотек на максимально возможные версии, а также удаление лишних
- заметное уменьшение количества спама в консоль при запуске сервера
- адаптация PlayerContainerFix https://github.com/juanmuscaria/Gambiarra-BetterQuesting
- улучшенная обработка мертвых сущностей (превентивные меры против дюпов + оптимизация)
- удаление большого количества мусора оставленного командами Cauldron и Thermos
- удаление тысяч бесполезных переменных OBFID оставшихся после декомпиляции майна через mcp
- перенос полезных патчей из поздних билдов Thermos
- перенос полезных патчей из движка CrucibleMC

### Конфигурация
- конфиги bukkit.yml, spigot.yml, cauldron.yml, thermos.yml объеденены в server.yml (лежит рядом на гите)
- конфиги tileentities.yml и entities.yml объеденены в enviroment.yml (лежит рядом на гите)
- из конфигураций удалены нерабочие, бесполезные и кривые настройки
- добавлена возможность более тонкой настройки различных опций
- опциональное отключение вспомогательных потоков для оптимизации (метрика плагинов и тд)
- опциональное отключение проверок движения (откаты игроков во время бега при лагах или медленном инете)

### Фиксы дюпов
- фикс дюпа через откат чанков (ошибка с очередью сохранения)
- фикс дюпа через сохранение больших чанков (>2mb)
- фикс дюпа коров через пакетхак в Xenobyte
- фикс дюпа рельсов через поршни

### Оптимизации
- вызов bukkit ивентов через ASM<br>
  во всех ядрах поддеживающих bukkit плагины вызов ивентов реализован через медленную рефлексию (ReflectionAPI),<br>
  в этом ядре реализована динамическая генерация классов через ASM трансформеры, что позволяет вызывать их напрямую
- оптимизированные алгоритмы поиска маршрута и передвижения у сущностей
- оптимизированный алгоритм расчета коллизий
- отключение коллизий в чанке при достижении выбранного количества сущностей
- оптимизация распространения огня с возможностью его полного отключения
- оптимизированная реализация Math.atan2 и еще части математических функций
- оптимизированная реализация Random (xorshift алгоритм)
- микрооптимизации в сохранении чанков и ChunkCache
- кеширование для стандартных правил (GameRules)

### Исправления ошибок
- исправление различных NullPointerException, ArrayIndexOutOfBoundsException, ConcurrentModificationException
- синхронизация HashedArrayList во избежание различных ошибок
- синхронизация получения сущностей через BukkitAPI (ошибки с асинхронными плагинами чата)
- исправление рекурсивного вызова BiomeDecorator
- исправление ошибки возникающей при повторяющихся зачарованиях на предметах из-за кривых модов
- исправления в логике FakePlayer'ов для избежания различных ошибок из-за кривых модов
- исправление уязвимости CVE-2021-35054 https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-35054
- исправление уязвимости CVE-2021-44228 https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2021-44228
